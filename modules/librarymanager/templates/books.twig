{% extends "_layouts/cp" %}
{% set title = "ðŸ“š Manage Books" %}

{% block content %}
	<h2>ðŸ“š Manage Books</h2>

	{% set section = craft.app.sections.getSectionByHandle('books') %}
	{% set entryType = section.entryTypes[0] ?? null %}

	<h3>Add New Book</h3>

	{% if craft.app.request.getParam('success') %}
		<p style="color:green;">âœ… Book added successfully!</p>
	{% endif %}

	<form method="POST" accept-charset="UTF-8" enctype="multipart/form-data">
		{{ csrfInput() }}
		<input type="hidden" name="action" value="entries/save-entry">
		<input type="hidden" name="sectionId" value="{{ section.id }}">
		<input type="hidden" name="entryTypeId" value="{{ entryType.id }}">
		<input type="hidden" name="siteId" value="{{ currentSite.id }}">
		<input type="hidden" name="enabled" value="1">
		<input type="hidden" name="redirect" value="{{ 'librarymanager/books?success=1' | hash }}">


		<label>Title:</label>
		<input type="text" name="title" required><br>

		<label>Book Title:</label>
		<input type="text" name="fields[bookTitle]" required><br>

		<label>Author:</label>
		<input type="text" name="fields[bookAuthor]" required><br>

		<label>ISBN:</label>
		<input type="text" name="fields[isbn]" required><br>

		<label>Is Borrowed:</label>
		<input type="checkbox" name="fields[isBorrowed]" value="1"><br>

		<button type="submit">Add Book</button>
	</form>

	<hr>

	<h3>ðŸ“‹ List of Books</h3>

	{% set books = craft.entries.section('books').all() %}

	<table border="1" cellpadding="8">
		<thead>
			<tr>
				<th>Title</th>
				<th>Book Title</th>
				<th>Author</th>
				<th>ISBN</th>
				<th>Status</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			{% for book in books %}
				<tr>
					<td>{{ book.title }}</td>
					<td>{{ book.bookTitle }}</td>
					<td>{{ book.bookAuthor }}</td>
					<td>{{ book.isbn }}</td>
					<td>
						{% if book.isBorrowed %}
							<span style="color:red;">Borrowed</span>
						{% else %}
							<span style="color:green;">Available</span>
						{% endif %}
					</td>
					<td>
						<form method="POST" style="display:inline;">
							{{ csrfInput() }}
							<input type="hidden" name="action" value="entries/delete">
							<input type="hidden" name="elementId" value="{{ book.id }}">
							<button type="submit" onclick="return confirm('Delete this book?')">ðŸ—‘ Delete</button>
						</form>
					</td>
				</tr>
			{% else %}
				<tr>
					<td colspan="6">No books found.</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}
